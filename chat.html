<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Vchat - Chat</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>
<body class="chat-page">

  <!-- Top Header -->
  <header class="chat-header">
    <button onclick="goBack()" class="back-btn">‚Üê</button>
    
    <div class="chat-user-info">
      <div class="chat-avatar" id="chat-avatar">A</div>
      <div>
        <!-- <h2 id="chat-username">Friend Name</h2> -->
         <div id="chat-header">
  <strong id="friend-name"></strong><br>
  <small id="friend-status">Checking status...</small>
</div>


       
      </div>
    </div>
  </header>

  <!-- Message Area -->
  <main class="chat-main" id="message-container">
    <!-- Messages will appear here -->
  </main>

  <!-- Input Area -->
  <footer class="chat-input-area">
    <input type="text" id="message-input" placeholder="Type a message..." />
    <button class="send-msg-btn" id="send-btn">SEND</button>
  </footer>

  <script src="chat.js"></script>

    <script>
    // presence.js
const userId = localStorage.getItem("vchatUserId");
if (!firebase.apps.length) {
  firebase.initializeApp({
    apiKey: "AIzaSyDMg6CD6aBHSix57jcxFDvB4uHk4RDrJyc",
    authDomain: "vchat-5ba2e.firebaseapp.com",
    databaseURL: "https://vchat-5ba2e-default-rtdb.firebaseio.com",
    projectId: "vchat-5ba2e",
    storageBucket: "vchat-5ba2e.appspot.com",
    messagingSenderId: "64968376129",
    appId: "1:64968376129:web:367ef0bdb422eb1904ebc0"
  });
}

if (userId) {
  const db = firebase.database();
  const userStatusRef = db.ref(`/status/${userId}`);
  const connectedRef = db.ref(".info/connected");

  const isOfflineForDatabase = {
    state: "offline",
    last_changed: firebase.database.ServerValue.TIMESTAMP,
  };

  const isOnlineForDatabase = {
    state: "online",
    last_changed: firebase.database.ServerValue.TIMESTAMP,
  };

  connectedRef.on("value", (snapshot) => {
    if (snapshot.val() === false) return;

    userStatusRef
      .onDisconnect()
      .set(isOfflineForDatabase)
      .then(() => {
        userStatusRef.set(isOnlineForDatabase);
      });
  });
}

  </script>
</body>
</html>
